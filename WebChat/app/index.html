<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <script type="text/javascript" src="libs/jquery-1.6.4.min.js"></script>
    <script type="text/javascript" src="libs/jquery.signalR-2.2.0.min.js"></script>
    <script src="../signalr/hubs"></script>
    <script>
        $(function () {
            $("#btnLogin").click(function () {
                $.ajax({
                    url: "/api/auth/login",
                    type: "GET",
                    data: {
                        username: $("#txtUser").val(),
                        password: ""
                    }
                }).done(function () {
                    // Reference the auto-generated proxy for the hub.  
                    var chat = $.connection.chatHub;
                    // Create a function that the hub can call back to display messages.
                    chat.client.addNewMessageToPage = function (name, message) {
                        // Add the message to the page. 
                        $('#discussion').append('<li><strong>' + htmlEncode(name)
                            + '</strong>: ' + htmlEncode(message) + '</li>');
                    };

                    // Set initial focus to message input box.  
                    $('#message').focus();
                    // Start the connection.
                    $.connection.hub.start().done(function () {
                        $('#sendmessage').click(function () {
                            // Call the Send method on the hub. 
                            chat.server.send($('#displayname').val(), $('#message').val());
                            // Clear text box and reset focus for next comment. 
                            $('#message').val('').focus();
                        });
                    });
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
</head>
<body>
    <h2>Chat</h2>
    <div>
        user <input type="text" id="txtUser" />
        <button id="btnLogin">Login</button>
    </div>
    <div class="container">
        <input type="text" id="message" />
        <input type="button" id="sendmessage" value="Send" />
        <input type="hidden" id="displayname" />
        <ul id="discussion">
        </ul>
    </div>
</body>
</html>
